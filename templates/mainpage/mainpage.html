<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome CSS CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="flex flex-col items-center min-h-screen bg-white">
     <!-- 상단 바 -->
    <div class="w-[1017px] h-[94px] bg-white p-4 flex justify-between items-center border-b border-gray-300">
        <div class="text-3xl font-bold text-gray-800">오운완</div>
        <div class="flex space-x-6 text-sm text-gray-800">
            <a href="/board" class="text-gray-800 hover:text-[#38773E] transition duration-300">메이트찾기</a>
            <a href="/mypage" class="text-gray-800 hover:text-[#38773E] transition duration-300">마이페이지</a>
            <a href="/logout" class="text-gray-800 hover:text-[#38773E] transition duration-300">로그아웃</a>
        </div>
    </div>

    <!-- 메인 컨텐츠 -->
    <div class="container mx-auto p-4 w-[1017px]">
        <h1 class="text-xl font-bold mb-4">안녕하세요, {{ nickname }}님!</h1>

        <!-- 달력 / 출석률 / 웍스아웃 그래프 등 -->
        <div class="grid grid-cols-2 gap-4">
            <!-- 왼쪽: 달력 -->
            <div class="bg-gray-50 p-4 shadow rounded-lg flex-col">
                <h2 class="text-xl font-semibold mb-4 text-center">
                    abcd님의 오운완 캘린더
                </h2>
                
                <div class="flex items-center justify-center mb-4">
                    <div class="w-7 h-7 rounded-full mr-4 cursor-pointer flex items-center justify-center" onclick="changeMonth(-1)" style="background-color: #38773E;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-4 h-4">
                            <path d="M15.75 19.5L8.25 12l7.5-7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <span id="currentMonth" class="text-lg">2025년 3월</span>
                    <div class="w-7 h-7 rounded-full ml-4 cursor-pointer flex items-center justify-center" onclick="changeMonth(1)" style="background-color: #38773E;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-4 h-4">
                            <path d="M8.25 4.5l7.5 7.5-7.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>

                <div id="calendar" class="grid grid-cols-7 gap-1 text-center flex-grow">
                    <!-- 요일 헤더 (월~일) -->
                    <div class="font-bold">Mon</div>
                    <div class="font-bold">Tue</div>
                    <div class="font-bold">Wed</div>
                    <div class="font-bold">Thu</div>
                    <div class="font-bold">Fri</div>
                    <div class="font-bold">Sat</div>
                    <div class="font-bold">Sun</div>

                    <!-- 날짜들 -->
                    {% for day_info in calendar_data %}
                    {% if day_info.day is none %}
                        <!-- 달력 공백 -->
                        <div class="py-2"></div>
                    {% else %}
                        <div class="
                            py-2 rounded 
                            {% if day_info.status == 'no_records' %}
                                bg-white
                            {% elif day_info.status == 'all_checked' %}
                                bg-green-200
                            {% else %}
                                bg-red-200
                            {% endif %}
                        ">
                            <a href="{{ url_for('diary_page', date_str=day_info.date_str) }}">
                                {{ day_info.day }}
                            </a>
                        </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- 오른쪽: 출석률 / 웍스아웃 차트 -->
            <div class="flex flex-col gap-4">
                <!-- 출석률 원 그래프 -->
                <div class="bg-gray-50 p-4 shadow rounded-lg flex flex-col items-center justify-center h-64 w-full">
                    <h2 class="text-lg font-semibold mb-2">이달의 출석률</h2>
                    <div class="flex items-center">
                        <canvas id="attendanceChart" class="w-48 h-48"></canvas>
                    </div>
                </div>
                <!-- 웍스아웃 막대 그래프 -->
                <div class="bg-gray-50 p-4 shadow rounded-lg flex flex-col items-center justify-center h-64 w-full">
                    <h2 class="text-lg font-semibold mb-2">TOP 웍스아웃</h2>
                    <canvas id="workoutChart" class="w-70 h-70"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 최하단 고정 박스 -->
    <div class="w-full h-[50px] bg-[#38773E] flex justify-between items-center px-10 fixed bottom-0 left-0">
        <!-- 오운완 아이콘 -->
        <div class="text-white text-xl font-bold flex items-center space-x-2">
            <i class="fas fa-dumbbell"></i>
            <span>오운완</span>
        </div>
        <!-- 노션/깃허브 아이콘 -->
        <div class="flex items-center space-x-6">
            <a href="https://www.notion.so" target="_blank">
                <img src="../../static/images/notion_logo.png" alt="Notion" class="w-8 h-8 cursor-pointer">
            </a>
            <a href="https://github.com/craftonjungle8" target="_blank">
                <img src="../../static/images/Github_logo.png" alt="Github" class="w-8 h-8 cursor-pointer">
            </a>
        </div>
    </div>

    <!-- 차트 초기화 스크립트 (예시) -->
    <script>
        const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
        new Chart(attendanceCtx, {
            type: 'pie',
            data: {
                labels: ['출석', '결석'],
                datasets: [{
                    data: [41.379, 58.621],
                    backgroundColor: ['green', 'red'],
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false
            }
        });

        const workoutCtx = document.getElementById('workoutChart').getContext('2d');
        new Chart(workoutCtx, {
            type: 'bar',
            data: {
                labels: ['데드리프트', '스쿼트', '레그프레스', '벤치프레스'],
                datasets: [{
                    data: [13, 11, 9, 4],
                    backgroundColor: ['#fbbf24', '#38bdf8', '#a78bfa', '#facc15'],
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false
            }
        });

        let currentYear = 2025;
        let currentMonth = 3;

        function changeMonth(direction) {
            currentMonth += direction;

            if (currentMonth > 12) {
                currentYear++;
                currentMonth = 1;
            } else if (currentMonth < 1) {
                currentYear--;
                currentMonth = 12;
            }

            document.getElementById('currentMonth').innerText = `${currentYear}년 ${currentMonth}월`;
            
            // 서버에 새 달력 데이터를 요청하는 코드가 필요합니다
            // 예: location.href = `/main?year=${currentYear}&month=${currentMonth}`;
        }
    </script>
</body>
</html>
