<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게시글 리스트</title>
  <!-- Tailwind / FontAwesome -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="flex flex-col items-center min-h-screen">
  <!-- 상단 헤더 -->
  <div class="w-[1017px] h-[94px] bg-white p-4 flex justify-between items-center border-b border-gray-300">
    <div class="text-3xl font-bold text-gray-800">
      <a href="/mainpage" class="text-gray-800 hover:text-[#38773E] transition duration-300">오운완</a>
    </div>
    <div class="flex space-x-6 text-sm text-gray-800">
      <a href="/board" class="text-gray-800 hover:text-[#38773E] transition duration-300">메이트찾기</a>
      <a href="/mypage" class="text-gray-800 hover:text-[#38773E] transition duration-300">마이페이지</a>
      <a href="/logout" class="text-gray-800 hover:text-[#38773E] transition duration-300">로그아웃</a>
    </div>
  </div>

  <!-- 글 작성 버튼 -->
  <div class="w-[1017px] flex justify-end mt-2">
    <a href="/board/new" class="bg-[#38773E] text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300">작성</a>
  </div>

  <!-- 게시글 목록 -->
  <div class="flex flex-col items-center w-full mt-8">
    <div class="grid grid-cols-3 gap-4 w-[1017px]">
      {% for post in posts %}
      <div class="w-[320px] h-[180px] bg-white p-4 shadow-md rounded-lg flex flex-col justify-between cursor-pointer postCard"
           data-title="{{ post.title }}"
           data-date="{{ post.created_at }}"
           data-content="{{ post.content }}">
        <h3 class="text-lg font-bold" style="max-width: 280px; word-break: break-word;">{{ post.title }}</h3>
        <p class="text-sm text-gray-500 text-right">{{ post.created_at }}</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- 페이지 네이션 -->
  <div class="flex justify-center mt-8 space-x-2">
    {% for p in range(1, total_pages + 1) %}
      <a href="{{ url_for('board_list', page=p) }}"
         class="px-3 py-2 rounded transition duration-300 
                {% if p == current_page %}
                    bg-[#38773E] text-white
                {% else %}
                    bg-gray-200 hover:bg-gray-300 text-gray-800
                {% endif %}">
        {{ p }}
      </a>
    {% endfor %}
<<<<<<< HEAD
=======
  </div>

  <!-- 게시글 상세 모달 (댓글 기능 포함) -->
  <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-[#FFECD1] bg-opacity-50 hidden">
    <div class="bg-white w-[830px] h-[650px] p-6 rounded-lg shadow-lg flex flex-col overflow-y-auto">
      <h2 id="modalTitle" class="text-3xl font-bold text-gray-800"></h2>
      <div>
        <form method="POST" action="#" id="editPostForm" class="inline hidden">
            <button type="submit" class="bg-yellow-500 text-white p-2 rounded-lg hover:bg-yellow-600">수정하기</button>
        </form>
        <form method="POST" action="#" id="deletePostForm" class="inline hidden">
            <button type="submit" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">삭제하기</button>
        </form>
      </div>
      <div class="flex justify-between items-center">
        <p id="modalNickname" class="text-lg font-bold text-[#38773E] mb-4">{{ nickname }}</p>
        <p id="modalDate" class="text-sm text-gray-500 mb-4 text-right"></p>
      </div>
      <div id="modalContent" class="border p-4 h-[300px] overflow-y-auto bg-gray-100 rounded"></div>
      
      <!-- 댓글 섹션 -->
      <div id="modalCommentSection" class="mt-4">
        <h3 class="text-lg font-bold text-[#38773E]">댓글 작성</h3>
        <textarea id="commentInput" class="w-full h-[80px] p-2 border border-[#A7D1AB] rounded mt-2 focus:ring-[#A7D1AB] focus:border-[#A7D1AB] bg-[#F8FAF7]" placeholder="댓글을 입력하세요..."></textarea>
        <button id="submitComment" class="mt-2 px-4 py-2 bg-[#38773E] hover:bg-[#2A592E] text-white rounded transition duration-200">작성</button>
        <div id="commentList" class="mt-4">
          <h3 class="text-lg font-bold text-[#38773E] focus:ring-[#A7D1AB] focus:border-[#A7D1AB] bg-[#F8FAF7]">댓글 목록</h3>
          <ul class="mt-2 space-y-2"></ul>
        </div>
      </div>

    <button id="closeModal" class="mt-4 px-4 py-2 bg-red-500 text-white rounded">닫기</button>
>>>>>>> 2658ac9dc17057583950b8b50f52d2d7224e6d4e
  </div>

  <!-- 게시글 상세 모달 (댓글 기능 포함) -->
  <div id="postModal" class="fixed inset-0 flex items-center justify-center bg-[#FFECD1] bg-opacity-50 hidden">
    <div class="bg-white w-[830px] h-[650px] p-6 rounded-lg shadow-lg flex flex-col overflow-y-auto">
      <div class="flex justify-between items-center">
        <h2 id="modalTitle" class="text-3xl font-bold text-gray-800"></h2>
        <div class="flex space-x-2">
          <form method="POST" action="#" id="editPostForm" class="inline hidden">
            <button type="submit" class="bg-yellow-500 text-white p-2 rounded-lg hover:bg-yellow-600">수정하기</button>
          </form>
          <form method="POST" action="#" id="deletePostForm" class="inline hidden" onsubmit="return confirmDelete();">
            <button type="submit" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">삭제하기</button>
          </form>
        </div>
      </div>
      <div class="flex justify-between items-center">
        <p id="modalNickname" class="text-lg font-bold text-[#38773E] mb-4">{{ nickname }}</p>
        <p id="modalDate" class="text-sm text-gray-500 mb-4 text-right"></p>
      </div>
      <div id="modalContent" class="border p-4 h-[300px] overflow-y-auto bg-gray-100 rounded"></div>
      
      <!-- 댓글 섹션 -->
      <div id="modalCommentSection" class="mt-4">
        <h3 class="text-lg font-bold text-[#38773E]">댓글 작성</h3>
        <textarea id="commentInput" class="w-full h-[80px] p-2 border border-[#A7D1AB] rounded mt-2 focus:ring-[#A7D1AB] focus:border-[#A7D1AB] bg-[#F8FAF7]" placeholder="댓글을 입력하세요..."></textarea>
        <button id="submitComment" class="mt-2 px-4 py-2 bg-[#38773E] hover:bg-[#2A592E] text-white rounded transition duration-200">작성</button>
        <div id="commentList" class="mt-4">
          <h3 class="text-lg font-bold text-[#38773E] focus:ring-[#A7D1AB] focus:border-[#A7D1AB] bg-[#F8FAF7]">댓글 목록</h3>
          <ul class="mt-2 space-y-2"></ul>
        </div>
      </div>
  
      <button id="closeModal" class="mt-4 px-4 py-2 bg-red-500 text-white rounded">닫기</button>
    </div>
  </div>

  <!-- 하단 고정 박스 -->
  <div class="w-full h-[50px] bg-[#38773E] flex justify-between items-center px-10 fixed bottom-0 left-0">
    <div class="text-white text-xl font-bold flex items-center space-x-2">
      <i class="fas fa-dumbbell"></i>
      <span>오운완</span>
    </div>
    <div class="flex items-center space-x-6">
      <a href="https://www.notion.so/1b2d5b3e6ec58080ae3bcc88009abb41?pvs=4" target="_blank">
        <img src="../../static/images/notion_logo.png" alt="Notion" class="w-8 h-8 cursor-pointer">
      </a>
      <a href="https://github.com/craftonjungle8" target="_blank">
        <img src="../../static/images/github_logo.png" alt="GitHub" class="w-8 h-8 cursor-pointer">
      </a>
    </div>
  </div>

  <script>
<<<<<<< HEAD
    function confirmDelete() {
      return confirm("정말 삭제하시겠습니까?");
    }

=======
>>>>>>> 2658ac9dc17057583950b8b50f52d2d7224e6d4e
    // 현재 사용자 ID 설정 (서버에서 Jinja2를 통해 가져오기)
    const currentUserId = "{{ current_user['_id'] }}"; 

    // 각 게시글 카드를 클릭하면 모달에 데이터를 채워 넣고 모달을 표시합니다.
    const postCards = document.querySelectorAll('.postCard');
    postCards.forEach(card => {
      card.addEventListener('click', () => {
        const title = card.getAttribute('data-title');
        const date = card.getAttribute('data-date');
        const content = card.getAttribute('data-content');
        const postId = card.getAttribute('data-id');
        const postUserId = card.getAttribute('data-user-id'); // 게시글 작성자 ID 추가

        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalDate').textContent = date;
        document.getElementById('modalContent').textContent = content;

        // 모달이 열릴 때 이전 댓글 목록 초기화
        document.querySelector('#commentList ul').innerHTML = '';
        document.getElementById('postModal').classList.remove('hidden');

        // 수정 및 삭제 버튼 표시 여부
        if (postUserId === currentUserId) {
            document.getElementById('editPostForm').classList.remove('hidden');
            document.getElementById('deletePostForm').classList.remove('hidden');
        } else {
            document.getElementById('editPostForm').classList.add('hidden');
            document.getElementById('deletePostForm').classList.add('hidden');
        }

        // 수정 버튼 클릭 이벤트
        document.getElementById('editPostForm').onsubmit = function(event) {
            event.preventDefault(); // 기본 폼 제출 방지
            window.location.href = `/board/${postId}/edit`; // 수정 페이지로 리다이렉트
        };

        // 삭제 버튼 클릭 이벤트
        document.getElementById('deletePostForm').onsubmit = function(event) {
            event.preventDefault(); // 기본 폼 제출 방지
            if (confirmDelete()) { // 삭제 확인 경고
                fetch(`/board/${postId}/delete`, { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            // 삭제 성공 후 페이지 새로 고침
                            location.reload();
                        } else {
                            console.error('삭제 실패:', response.statusText);
                        }
                    });
            }
        };
    });
});

    // 모달 닫기 기능
    document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('postModal').classList.add('hidden');
    });

    // 댓글 작성 기능
    document.getElementById('submitComment').addEventListener('click', () => {
      const commentInput = document.getElementById('commentInput');
      const commentText = commentInput.value.trim();
      if (!commentText) return;

      const commentList = document.querySelector('#commentList ul');
      const listItem = document.createElement('li');
      listItem.className = 'p-2 border rounded bg-gray-100';
      listItem.innerHTML = `<strong>${document.getElementById('modalNickname').textContent}</strong> <span class="text-sm text-gray-500">${new Date().toLocaleString()}</span>
                            <p>${commentText}</p>`;
      commentList.appendChild(listItem);
      commentInput.value = '';
    });

    // 게시글 제목 글자 수 제한 및 줄바꿈 처리
    const titleElements = document.querySelectorAll('.postCard h3');

    titleElements.forEach(titleElement => {
      const maxLength = 30;
      let titleText = titleElement.textContent;

      if (titleText.length > maxLength) {
        titleText = titleText.slice(0, maxLength) + "..."; // 넘치는 텍스트를 자르고 "..." 추가
      }

      titleElement.textContent = titleText; // 수정된 제목 텍스트 설정
    });
  </script>


</body>
</html>